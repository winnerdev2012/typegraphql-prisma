# Migration `20200922192002-initial`

This migration has been generated by Micha≈Ç Lytek at 9/22/2020, 9:20:02 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TYPE "public"."Role" AS ENUM ('USER', 'ADMIN')

CREATE TYPE "public"."PostKind" AS ENUM ('BLOG', 'ADVERT')

CREATE TABLE "public"."User" (
"id" SERIAL,
"email" text   NOT NULL ,
"name" text   ,
"age" integer   NOT NULL ,
"balance" Decimal(65,30)   NOT NULL ,
"amount" Decimal(65,30)   NOT NULL ,
"role" "Role"  NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."post" (
"uuid" text   NOT NULL ,
"createdAt" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
"updatedAt" timestamp(3)   NOT NULL ,
"published" boolean   NOT NULL ,
"title" text   NOT NULL ,
"subtitle" text   NOT NULL ,
"content" text   ,
"authorId" integer   NOT NULL ,
"kind" "PostKind"  ,
"metadata" jsonb   NOT NULL ,
PRIMARY KEY ("uuid")
)

CREATE TABLE "public"."Category" (
"name" text   NOT NULL ,
"slug" text   NOT NULL ,
"number" integer   NOT NULL 
)

CREATE TABLE "public"."Patient" (
"firstName" text   NOT NULL ,
"lastName" text   NOT NULL ,
"email" text   NOT NULL ,
PRIMARY KEY ("firstName","lastName")
)

CREATE TABLE "public"."Movie" (
"directorFirstName" text   NOT NULL ,
"directorLastName" text   NOT NULL ,
"title" text   NOT NULL ,
PRIMARY KEY ("directorFirstName","directorLastName","title")
)

CREATE TABLE "public"."Director" (
"firstName" text   NOT NULL ,
"lastName" text   NOT NULL ,
PRIMARY KEY ("firstName","lastName")
)

CREATE TABLE "public"."Problem" (
"id" SERIAL,
"problemText" text   NOT NULL ,
"creatorId" integer   ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."Creator" (
"id" SERIAL,
"name" text   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."_CreatorToProblem" (
"A" integer   NOT NULL ,
"B" integer   NOT NULL 
)

CREATE UNIQUE INDEX "User.email_unique" ON "public"."User"("email")

CREATE UNIQUE INDEX "Category.slug_number_unique" ON "public"."Category"("slug", "number")

CREATE UNIQUE INDEX "_CreatorToProblem_AB_unique" ON "public"."_CreatorToProblem"("A", "B")

CREATE INDEX "_CreatorToProblem_B_index" ON "public"."_CreatorToProblem"("B")

ALTER TABLE "public"."post" ADD FOREIGN KEY ("authorId")REFERENCES "public"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."Movie" ADD FOREIGN KEY ("directorFirstName", "directorLastName")REFERENCES "public"."Director"("firstName","lastName") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."Problem" ADD FOREIGN KEY ("creatorId")REFERENCES "public"."Creator"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."_CreatorToProblem" ADD FOREIGN KEY ("A")REFERENCES "public"."Creator"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."_CreatorToProblem" ADD FOREIGN KEY ("B")REFERENCES "public"."Problem"("id") ON DELETE CASCADE ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration ..20200922192002-initial
--- datamodel.dml
+++ datamodel.dml
@@ -1,0 +1,114 @@
+datasource db {
+  provider = "postgresql"
+  url = "***"
+}
+
+type Numeric = Float
+
+generator client {
+  provider        = "prisma-client-js"
+  binaryTargets   = ["windows", "debian-openssl-1.1.x"]
+  output          = "../prisma/generated/client"
+  previewFeatures = ["connectOrCreate", "atomicNumberOperations"]
+}
+
+generator typegraphql {
+  provider = "node ../src/cli/dev.ts"
+  output   = "../prisma/generated/type-graphql"
+  emitDMMF = true
+}
+
+// Role enum comment
+/// Role enum doc
+enum Role {
+  USER
+  ADMIN
+}
+
+// User model comment
+/// User model doc
+/// @@TypeGraphQL.type(name: "Client")
+model User {
+  // User model field comment
+  /// User model field doc
+  id      Int     @default(autoincrement()) @id
+  email   String  @unique
+  /// renamed field doc
+  /// @TypeGraphQL.field(name: "firstName")
+  name    String?
+  age     Int
+  /// @TypeGraphQL.field(name: "accountBalance")
+  balance Numeric
+  amount  Float
+  /// @TypeGraphQL.field(name: "clientPosts")
+  posts   post[]
+  role    Role
+}
+
+enum PostKind {
+  BLOG
+  ADVERT
+}
+
+model post {
+  uuid      String    @default(uuid()) @id
+  createdAt DateTime  @default(now())
+  updatedAt DateTime  @updatedAt
+  published Boolean
+  title     String
+  /// @TypeGraphQL.omit(output: true)
+  subtitle  String
+  content   String?
+  author    User      @relation(fields: [authorId], references: [id])
+  authorId  Int
+  kind      PostKind?
+  metadata  Json
+}
+
+model Category {
+  name   String
+  slug   String
+  number Int
+
+  @@unique([slug, number])
+}
+
+model Patient {
+  firstName String
+  lastName  String
+  email     String
+
+  @@id([firstName, lastName])
+}
+
+model Movie {
+  directorFirstName String
+  directorLastName  String
+  director          Director @relation(fields: [directorFirstName, directorLastName], references: [firstName, lastName])
+  title             String
+
+  @@id([directorFirstName, directorLastName, title])
+}
+
+model Director {
+  firstName String
+  lastName  String
+  movies    Movie[]
+
+  @@id([firstName, lastName])
+}
+
+model Problem {
+  id          Int       @default(autoincrement()) @id
+  problemText String
+  likedBy     Creator[]
+  creator     Creator?  @relation(name: "creator", fields: [creatorId], references: [id])
+  creatorId   Int?
+}
+
+model Creator {
+  id       Int       @default(autoincrement()) @id
+  name     String
+  likes    Problem[]
+  problems Problem[] @relation("creator")
+}
```


